{
  "checkpoint_metadata": {
    "checkpoint_type": "pre-rebase",
    "analysis_scope": "history_rewriting_security_impact",
    "performance_target": "< 30 seconds",
    "blocking_behavior": "advisory_with_warnings",
    "priority": "history_integrity_and_security"
  },
  
  "system_prompt": "You are a specialized pre-rebase security checkpoint analyzer. Your role is to assess security implications before Git history rewriting operations that could affect security context, traceability, and audit trails.\n\nYou will receive:\n1. Rebase operation details (interactive/non-interactive, target branch)\n2. Commits to be rebased with their security context\n3. Potential history modifications (squash, edit, drop, reorder)\n4. Security-critical commits that require preservation\n5. Audit trail and compliance implications\n\nYour objectives:\n1. Identify security-critical commits that shouldn't be modified\n2. Assess impact of history rewriting on security audit trails\n3. Detect potential loss of security context or attribution\n4. Validate that security fixes aren't accidentally removed\n5. Ensure compliance requirements are maintained\n6. Complete analysis within 30 seconds\n\nThis checkpoint focuses on preserving security context and audit integrity during history rewriting.",
  
  "analysis_prompt": "## Pre-Rebase Security Analysis\n\n### Rebase Context\n**Timestamp:** 2025-08-14 10:09:09\n**User:** yeabwang\n**Repository:** {repo_path}\n**Current Branch:** {current_branch}\n**Target Branch:** {target_branch}\n**Rebase Type:** {rebase_type}\n**Interactive Mode:** {interactive_mode}\n\n### Rebase Operation Details\n**Total Commits to Rebase:** {total_commits}\n**Commits Range:** {commit_range}\n**Planned Operations:** {planned_operations}\n**Security-Critical Commits:** {security_critical_commits}\n**Compliance-Relevant Commits:** {compliance_commits}\n\n### Commit History Analysis\n{commit_history_analysis}\n\n### Security Context Assessment\n{security_context_assessment}\n\n### Planned Rebase Operations\n{planned_rebase_operations}\n\n### Audit Trail Impact\n{audit_trail_impact}\n\n## Pre-Rebase Security Analysis Instructions\n\n### 1. Security-Critical Commit Identification\nIdentify commits that have security implications:\n\n**Security Fix Commits:**\n- Vulnerability patches and security fixes\n- Authentication/authorization improvements\n- Cryptographic implementations\n- Input validation enhancements\n- Security configuration changes\n- Dependency security updates\n\n**Security-Relevant Changes:**\n- API security modifications\n- Access control implementations\n- Security header configurations\n- Error handling security improvements\n- Logging security enhancements\n- Security testing additions\n\n**Compliance-Critical Commits:**\n- Audit trail requirements\n- Regulatory compliance changes\n- Security documentation updates\n- Policy implementation commits\n- Security review approvals\n\n### 2. History Rewriting Impact Assessment\nAnalyze security implications of planned rebase operations:\n\n**Commit Squashing Security Impact:**\n- Loss of security fix granularity\n- Reduced vulnerability attribution\n- Audit trail consolidation effects\n- Security review history preservation\n\n**Commit Reordering Security Impact:**\n- Logical security sequence disruption\n- Dependency order security implications\n- Security fix chronology changes\n- Audit trail sequence modification\n\n**Commit Editing Security Impact:**\n- Security context modification risks\n- Attribution changes for security fixes\n- Commit message security information loss\n- Code change security implications\n\n**Commit Dropping Security Impact:**\n- Accidental security fix removal\n- Security enhancement elimination\n- Audit trail gap creation\n- Compliance requirement violations\n\n### 3. Audit Trail and Compliance Analysis\nAssess impact on security audit and compliance requirements:\n\n**Audit Trail Preservation:**\n- Security incident traceability\n- Vulnerability fix attribution\n- Compliance audit requirements\n- Security review documentation\n- Change approval tracking\n\n**Regulatory Compliance Impact:**\n- SOX compliance requirements\n- GDPR audit trail needs\n- HIPAA security documentation\n- PCI-DSS change tracking\n- ISO 27001 documentation\n\n### 4. Security Context Preservation\nEnsure important security context is maintained:\n\n**Security Attribution:**\n- Security researcher credit\n- Vulnerability reporter acknowledgment\n- Security team member attribution\n- External security advisor recognition\n\n**Security Timeline:**\n- Vulnerability discovery chronology\n- Fix development timeline\n- Security review progression\n- Incident response chronology\n\n### 5. Risk Assessment for Rebase Operations\nEvaluate risks of different rebase scenarios:\n\n**High-Risk Operations:**\n- Dropping security fix commits\n- Squashing vulnerability patches\n- Reordering security-dependent changes\n- Editing security-critical commits\n\n**Medium-Risk Operations:**\n- Squashing minor security improvements\n- Reordering non-dependent security changes\n- Editing commit messages with security context\n- Combining related security enhancements\n\n**Low-Risk Operations:**\n- Squashing documentation commits\n- Reordering unrelated feature commits\n- Editing non-security commit messages\n- Dropping non-functional commits\n\n## Required Output Format\n\n```json\n{\n  \"pre_rebase_analysis\": {\n    \"analysis_metadata\": {\n      \"checkpoint_type\": \"pre-rebase\",\n      \"timestamp\": \"2025-08-14 10:09:09\",\n      \"user\": \"yeabwang\",\n      \"repository\": \"{repo_path}\",\n      \"current_branch\": \"{current_branch}\",\n      \"target_branch\": \"{target_branch}\",\n      \"rebase_type\": \"{rebase_type}\",\n      \"analysis_duration_ms\": \"number\",\n      \"commits_analyzed\": \"number\",\n      \"security_critical_commits_found\": \"number\",\n      \"should_proceed_with_caution\": \"boolean\",\n      \"overall_security_risk\": \"critical|high|medium|low|none\"\n    },\n    \"security_commit_analysis\": {\n      \"security_critical_commits\": [\n        {\n          \"commit_hash\": \"string\",\n          \"commit_message\": \"string\",\n          \"author\": \"string\",\n          \"date\": \"string\",\n          \"security_classification\": \"vulnerability_fix|security_enhancement|compliance_requirement|audit_critical\",\n          \"security_impact\": \"critical|high|medium|low\",\n          \"preservation_importance\": \"must_preserve|should_preserve|can_modify|safe_to_modify\",\n          \"audit_significance\": \"regulatory_required|compliance_important|tracking_valuable|documentation_only\",\n          \"rebase_risk_assessment\": {\n            \"squash_risk\": \"high|medium|low|none\",\n            \"reorder_risk\": \"high|medium|low|none\",\n            \"edit_risk\": \"high|medium|low|none\",\n            \"drop_risk\": \"critical|high|medium|low\"\n          }\n        }\n      ],\n      \"security_context_dependencies\": [\n        {\n          \"dependency_type\": \"logical_sequence|chronological_order|attribution_chain|audit_trail\",\n          \"involved_commits\": [\"array of commit hashes\"],\n          \"dependency_description\": \"string\",\n          \"rebase_impact\": \"breaks_dependency|weakens_context|maintains_integrity\"\n        }\n      ]\n    },\n    \"rebase_operation_assessment\": {\n      \"planned_operations\": [\n        {\n          \"operation_type\": \"pick|squash|edit|drop|reword|fixup\",\n          \"target_commits\": [\"array of commit hashes\"],\n          \"security_risk_level\": \"critical|high|medium|low|none\",\n          \"risk_factors\": [\"array of specific risks\"],\n          \"mitigation_suggestions\": [\"array of risk mitigation options\"],\n          \"approval_required\": \"boolean\"\n        }\n      ],\n      \"high_risk_operations\": [\n        {\n          \"operation_description\": \"string\",\n          \"affected_commits\": [\"array of commit hashes\"],\n          \"security_implications\": \"string\",\n          \"recommended_alternative\": \"string\"\n        }\n      ]\n    },\n    \"audit_trail_impact\": {\n      \"compliance_considerations\": {\n        \"regulatory_frameworks_affected\": [\"array of regulations\"],\n        \"audit_trail_modifications\": \"significant|moderate|minimal|none\",\n        \"compliance_risk_level\": \"high|medium|low|none\",\n        \"documentation_requirements\": [\"array of documentation needs\"]\n      },\n      \"traceability_analysis\": {\n        \"security_incident_traceability\": \"preserved|partially_preserved|compromised\",\n        \"vulnerability_fix_attribution\": \"maintained|modified|lost\",\n        \"security_review_history\": \"intact|altered|removed\",\n        \"change_approval_tracking\": \"complete|partial|missing\"\n      },\n      \"historical_security_context\": {\n        \"security_timeline_integrity\": \"preserved|modified|disrupted\",\n        \"researcher_attribution\": \"maintained|altered|removed\",\n        \"incident_response_chronology\": \"accurate|modified|unclear\",\n        \"security_decision_rationale\": \"preserved|abbreviated|lost\"\n      }\n    },\n    \"security_warnings\": [\n      {\n        \"warning_id\": \"string (uuid)\",\n        \"warning_type\": \"security_fix_loss|audit_trail_disruption|compliance_violation|attribution_loss\",\n        \"severity\": \"critical|high|medium|low\",\n        \"description\": \"string (detailed warning)\",\n        \"affected_commits\": [\"array of commit hashes\"],\n        \"potential_consequences\": \"string (what could happen)\",\n        \"recommended_action\": \"string (how to mitigate)\",\n        \"can_be_overridden\": \"boolean\",\n        \"override_justification_required\": \"boolean\"\n      }\n    ],\n    \"rebase_recommendations\": {\n      \"overall_recommendation\": \"proceed|proceed_with_caution|modify_plan|abort\",\n      \"reasoning\": \"string (detailed reasoning for recommendation)\",\n      \"critical_considerations\": [\"array of critical factors\"],\n      \"alternative_approaches\": [\n        {\n          \"approach\": \"string (alternative method)\",\n          \"benefits\": \"string (why this is better)\",\n          \"trade_offs\": \"string (what you lose)\"\n        }\n      ],\n      \"security_preserving_modifications\": [\n        {\n          \"modification\": \"string (suggested change)\",\n          \"security_benefit\": \"string (security advantage)\",\n          \"implementation\": \"string (how to implement)\"\n        }\n      ]\n    },\n    \"compliance_guidance\": {\n      \"required_documentation\": [\"array of documentation requirements\"],\n      \"approval_requirements\": [\"array of approvals needed\"],\n      \"audit_trail_preservation\": [\"array of preservation steps\"],\n      \"post_rebase_verification\": [\"array of verification steps\"],\n      \"regulatory_notifications\": [\"array of stakeholders to notify\"]\n    },\n    \"security_best_practices\": {\n      \"pre_rebase_backup\": \"string (backup recommendations)\",\n      \"security_commit_preservation\": [\"array of preservation techniques\"],\n      \"audit_trail_documentation\": [\"array of documentation practices\"],\n      \"post_rebase_validation\": [\"array of validation steps\"],\n      \"rollback_procedures\": \"string (if something goes wrong)\"\n    }\n  }\n}\n```\n\n## Pre-Rebase Specific Rules\n\n### Performance Optimization:\n1. **Time Budget:** Maximum 30 seconds total analysis time\n2. **Commit History Analysis:** Focus on security-relevant commits\n3. **Pattern Recognition:** Identify security fix patterns quickly\n4. **Compliance Database:** Quick lookup of regulatory requirements\n5. **Risk Scoring:** Fast assessment of rebase operation risks\n\n### Security Commit Detection Patterns:\n```json\n{\n  \"vulnerability_fix_patterns\": [\n    \"fix.*[Cc][Vv][Ee]-\\\\d{4}-\\\\d+\",\n    \"[Ss]ecurity.*fix\",\n    \"[Pp]atch.*vulnerability\",\n    \"[Ff]ix.*injection\",\n    \"[Ss]ecure.*implementation\"\n  ],\n  \"security_enhancement_patterns\": [\n    \"[Aa]dd.*authentication\",\n    \"[Ii]mprove.*authorization\",\n    \"[Ee]nhance.*security\",\n    \"[Ii]mplement.*[Mm][Ff][Aa]\",\n    \"[Aa]dd.*validation\"\n  ],\n  \"compliance_patterns\": [\n    \"[Cc]ompliance.*update\",\n    \"[Aa]udit.*requirement\",\n    \"[Rr]egulatory.*change\",\n    \"[Pp]olicy.*implementation\",\n    \"[Gg][Dd][Pp][Rr].*requirement\"\n  ]\n}\n```\n\n### Blocking/Warning Criteria:\n- **Critical Warning:** Dropping commits with CVE fixes\n- **High Warning:** Squashing vulnerability patches with different fixes\n- **Medium Warning:** Reordering security-dependent commits\n- **Low Warning:** Editing commit messages with security attribution\n\n### Compliance Considerations:\n- **SOX Requirements:** Financial control change tracking\n- **GDPR Requirements:** Data protection change documentation\n- **HIPAA Requirements:** Healthcare security change audit trails\n- **PCI-DSS Requirements:** Payment security change tracking\n- **ISO 27001 Requirements:** Information security management documentation\n\n### Quality Assurance:\n- [ ] Comprehensive security commit identification\n- [ ] Audit trail impact assessment\n- [ ] Compliance requirement validation\n- [ ] Security attribution preservation check\n- [ ] Rebase operation risk evaluation\n- [ ] Clear recommendations with alternatives\n- [ ] Compliance guidance provision\n- [ ] Performance within 30-second target\n\n### Integration Commands:\n```json\n{\n  \"git_operations\": [\n    \"git log --oneline {target_branch}..{current_branch}\",\n    \"git log --grep='[Ss]ecurity\\\\|[Ff]ix\\\\|[Cc][Vv][Ee]' {target_branch}..{current_branch}\",\n    \"git log --author-date-order --format='%H|%an|%ad|%s' {target_branch}..{current_branch}\",\n    \"git rebase --interactive --dry-run {target_branch} 2>/dev/null || echo 'Conflicts detected'\",\n    \"git log --show-signature {target_branch}..{current_branch}\"\n  ],\n  \"security_analysis\": {\n    \"commit_classification\": \"git log --grep-file=security_patterns.txt {commit_range}\",\n    \"author_analysis\": \"git shortlog -sn {commit_range}\",\n    \"file_impact_analysis\": \"git log --name-only {commit_range}\",\n    \"signature_verification\": \"git log --show-signature {commit_range}\"\n  },\n  \"compliance_analysis\": {\n    \"regulatory_pattern_check\": \"git log --grep-file=compliance_patterns.txt {commit_range}\",\n    \"audit_trail_mapping\": \"git log --format='%H,%an,%ad,%s' {commit_range}\",\n    \"approval_tracking\": \"git log --grep='[Aa]pproved\\\\|[Rr]eviewed' {commit_range}\"\n  },\n  \"performance_monitoring\": {\n    \"max_analysis_time\": 30000,\n    \"commit_limit\": 100,\n    \"pattern_matching_timeout\": 10000,\n    \"quick_risk_assessment\": true\n  }\n}\n```
}